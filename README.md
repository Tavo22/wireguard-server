# WireGuard Server Setup and Management

A comprehensive solution for setting up and managing a WireGuard VPN server on Linux systems. This project provides automated installation and easy client management for Ubuntu/Debian and CentOS/RHEL/Fedora systems.

## Features

- ğŸš€ **One-click installation** - Complete WireGuard server setup from scratch
- ğŸ”§ **Automatic configuration** - Handles all networking, firewall, and system settings
- ğŸ‘¥ **Client management** - Easy add/remove clients with QR codes
- ğŸ“Š **Status monitoring** - View server and client connection status
- ğŸ”’ **Security focused** - Generates unique keys and implements best practices
- ğŸ›¡ï¸ **Fail2ban integration** - Automatic protection against brute force attacks
- ğŸŒ **Multi-distro support** - Works on Ubuntu, Debian, CentOS, RHEL, Fedora
- ğŸ“± **QR code generation** - Easy mobile device configuration
- ğŸ’¾ **Backup functionality** - Backup and restore configurations

## Quick Start

### 1. Clone the Repository

```bash
git clone https://github.com/Tavo22/wireguard-server.git
cd wireguard-server
```

### 2. Install WireGuard Server

**Important**: Run as root (required for system configuration)

```bash
sudo ./install-wireguard.sh
```

The installation script will:
- Check system requirements and compatibility
- Detect your operating system automatically
- Install WireGuard and required dependencies
- Install and configure fail2ban for security
- Auto-detect your public IP (with manual override option)
- Configure networking and firewall rules
- Generate secure server keys and configuration
- Start and enable the WireGuard service
- Set up management tools
- Verify the installation is working

**Note**: The script includes comprehensive error checking and will stop if any critical step fails.

### 3. Add Your First Client

```bash
sudo ./wireguard-manager.sh add myclient
```

This will:
- Generate client configuration
- Create QR code for easy mobile setup
- Add client to server configuration
- Display the client configuration file

## Management Commands

After installation, you can use the management script to control your WireGuard server:

### Add a Client
```bash
sudo ./wireguard-manager.sh add [client-name]
```

### Remove a Client
```bash
sudo ./wireguard-manager.sh remove [client-name]
```

### List All Clients
```bash
sudo ./wireguard-manager.sh list
```

### Show Client Details
```bash
sudo ./wireguard-manager.sh show [client-name]
```

### Display QR Code
```bash
sudo ./wireguard-manager.sh qr [client-name]
```

### Check Server Status
```bash
sudo ./wireguard-manager.sh status
```

### Restart Service
```bash
sudo ./wireguard-manager.sh restart
```

### Backup Configurations
```bash
sudo ./wireguard-manager.sh backup
```

### Check Security Status
```bash
sudo ./wireguard-manager.sh security
```

### Unban IP Address
```bash
sudo ./wireguard-manager.sh unban [ip-address]
```

### Test Your Installation
```bash
sudo ./test-installation.sh
```

This comprehensive test script will verify:
- All system requirements are met
- WireGuard is properly installed and configured
- Network configuration is correct
- Security features are working
- Management tools are functional

### Help
```bash
sudo ./wireguard-manager.sh help
```

## System Requirements

### Supported Operating Systems
- Ubuntu 18.04+ 
- Debian 9+
- CentOS 7+
- RHEL 7+
- Fedora 32+

### Prerequisites
- Root access to the server
- Public IP address or domain name
- UDP port 51820 open in firewall (or custom port)

### Recommended Server Specs
- **Minimum**: 1 CPU core, 512MB RAM, 10GB storage
- **Recommended**: 2+ CPU cores, 1GB+ RAM, 20GB+ storage

## Installation Details

### What the Installation Script Does

1. **System Detection**: Automatically detects your Linux distribution
2. **Package Installation**: Installs WireGuard and required tools
3. **Network Configuration**: 
   - Enables IP forwarding
   - Configures NAT rules
   - Sets up iptables rules
4. **Key Generation**: Creates server private/public key pair
5. **Server Configuration**: Creates WireGuard server config file
6. **Firewall Setup**: Opens required ports in UFW/firewalld/iptables
7. **Service Setup**: Enables and starts WireGuard service
8. **Management Tools**: Installs client management scripts

### Default Configuration

- **Interface**: `wg0`
- **Port**: `51820/UDP`
- **Server IP**: `10.8.0.1/24`
- **Client Network**: `10.8.0.0/24`
- **DNS**: `1.1.1.1, 8.8.8.8`

## Client Setup

### Mobile Devices (Android/iOS)

1. Install the WireGuard app from your app store
2. Scan the QR code generated by the management script
3. Enable the VPN connection

### Desktop (Windows/macOS/Linux)

1. Install WireGuard client from [wireguard.com](https://www.wireguard.com/install/)
2. Import the client configuration file
3. Activate the tunnel

## File Structure

```
/etc/wireguard/
â”œâ”€â”€ wg0.conf              # Server configuration
â”œâ”€â”€ server.conf           # Server information
â””â”€â”€ clients/              # Client configurations
    â””â”€â”€ [client-name]/
        â”œâ”€â”€ [client-name].conf    # Client config file
        â”œâ”€â”€ [client-name].png     # QR code image
        â””â”€â”€ client.info           # Client metadata
```

## Security Best Practices

- ğŸ” **Unique Keys**: Every client gets unique private/public keys
- ğŸ›¡ï¸ **Preshared Keys**: Additional security layer for each client
- ğŸš« **No Default Passwords**: All authentication is key-based
- ğŸ“ **Secure Permissions**: Configuration files have restricted access
- ï¿½ï¸ **Fail2ban Protection**: Automatic IP banning for failed SSH attempts
- ï¿½ğŸ”„ **Regular Updates**: Keep WireGuard and system packages updated

### Fail2ban Configuration

The installation automatically configures fail2ban with these protections:

- **SSH Protection**: Bans IP after 3 failed attempts for 1 hour
- **Port Scan Protection**: Bans scanning attempts for 24 hours  
- **DDOS Protection**: Additional SSH DDOS protection
- **Custom Filters**: WireGuard-specific attack detection

#### Managing Fail2ban

Check security status:
```bash
sudo ./wireguard-manager.sh security
```

View banned IPs:
```bash
sudo fail2ban-client status sshd
```

Unban an IP:
```bash
sudo ./wireguard-manager.sh unban 192.168.1.100
```

Manual fail2ban commands:
```bash
sudo fail2ban-client status                    # Show all jails
sudo fail2ban-client status sshd              # Show SSH jail details
sudo fail2ban-client set sshd unbanip <IP>    # Unban specific IP
```

## Troubleshooting

### Check Service Status
```bash
sudo systemctl status wg-quick@wg0
```

### View Logs
```bash
sudo journalctl -u wg-quick@wg0 -f
```

### Test Connectivity
```bash
sudo wg show
```

### Check Firewall Rules
```bash
# Ubuntu/Debian
sudo ufw status

# CentOS/RHEL/Fedora
sudo firewall-cmd --list-all
```

### Restart Service
```bash
sudo systemctl restart wg-quick@wg0
```

## Common Issues

### Port Already in Use
If port 51820 is in use, edit `/etc/wireguard/wg0.conf` and change the `ListenPort` value.

### Can't Connect to Internet Through VPN
Check that IP forwarding is enabled:
```bash
cat /proc/sys/net/ipv4/ip_forward
# Should return 1
```

### Firewall Blocking Connections
Ensure your cloud provider's security groups allow UDP traffic on the WireGuard port.

## Advanced Configuration

### Custom Network Range
Edit `/etc/wireguard/wg0.conf` and update the `Address` field and client IP range.

### Custom DNS Servers
Modify client configurations to use different DNS servers.

### Split Tunneling
Configure clients to only route specific traffic through the VPN by modifying `AllowedIPs`.

## Backup and Restore

### Create Backup
```bash
sudo ./wireguard-manager.sh backup
```

### Manual Backup
```bash
sudo tar -czf wireguard-backup.tar.gz /etc/wireguard/
```

### Restore from Backup
```bash
sudo tar -xzf wireguard-backup.tar.gz -C /
sudo systemctl restart wg-quick@wg0
```

## Uninstallation

To completely remove WireGuard:

```bash
# Stop and disable service
sudo systemctl stop wg-quick@wg0
sudo systemctl disable wg-quick@wg0

# Remove configuration
sudo rm -rf /etc/wireguard/

# Remove package (Ubuntu/Debian)
sudo apt remove --purge wireguard wireguard-tools

# Remove package (CentOS/RHEL/Fedora)
sudo dnf remove wireguard-tools
# or
sudo yum remove wireguard-tools

# Remove management script
sudo rm -f /usr/local/bin/wg-manager
```

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Disclaimer

This software is provided as-is. Always test in a non-production environment first. The authors are not responsible for any damage or security issues that may arise from using this software.

## Support

For issues and questions:
- Check the troubleshooting section above
- Review WireGuard official documentation
- Open an issue on GitHub

---

**Note**: Always keep your server and WireGuard installation up to date for security reasons.